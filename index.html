<!DOCTYPE html>
<html lang="id" data-bs-theme="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üçö SIMART Kantin</title>
    <meta name="description" content="Kantin Digital SIMART menyediakan berbagai makanan dan minuman dengan sistem digital modern dan praktis." />

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>

    <style>
        :root {
            --primary-color: #3b82f6; 
            --secondary-color: #10b981; 
            --radius: 20px;
            --shadow-md: 0 10px 30px rgba(0, 0, 0, .1);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, .15);
        }
        
       
        [data-bs-theme="auto"], [data-bs-theme="light"] {
            --bs-body-bg-rgb: 224, 247, 250; 
            --body-bg: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            --text-color: #1e293b;
            --glass: rgba(255, 255, 255, .95);
            --surface-border: rgba(0, 0, 0, .05);
        }

        
        [data-bs-theme="dark"] {
            --bs-body-bg-rgb: 15, 23, 42;
            --body-bg: linear-gradient(135deg, #0f172a 0%, #1f2937 100%); 
            --text-color: #f1f5f9;
            --glass: rgba(30, 41, 59, .9); 
            --surface-border: rgba(255, 255, 255, .1);
        }

        body {
            background: var(--body-bg);
            font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
            min-height: 100dvh;
            color: var(--text-color);
            transition: background-color .3s, color .3s;
            position: relative;
            z-index: 1; 
            overflow-x: hidden;
        }

       
        .modal-content {
            background-color: var(--glass) !important;
            backdrop-filter: blur(8px) !important;
            border: 1px solid var(--surface-border) !important;
        }


        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1; 
            pointer-events: none;
        }

        .animated-icon {
            position: absolute;
            font-size: 25px;
            animation: moveIcon linear infinite;
            opacity: 0.5;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }

        @keyframes moveIcon {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }


        .navbar {
            background: var(--glass) !important;
            backdrop-filter: blur(12px);
            box-shadow: var(--shadow-md);
            border-bottom-left-radius: var(--radius);
            border-bottom-right-radius: var(--radius);
            z-index: 10;
        }
        
        .brand-gradient {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 900;
            letter-spacing: .5px;
            font-size: 1.5rem;
        }

        .surface {
            background: var(--glass);
            backdrop-filter: blur(8px);
            border: 1px solid var(--surface-border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            transition: all .3s ease;
            position: relative; 
            z-index: 2; 
        }
        
        .nav-pills .nav-link {
            border-radius: 12px;
            color: var(--text-color);
            opacity: 0.7;
            font-weight: 600;
            padding: .5rem 1rem;
            transition: all .3s ease;
        }
        .nav-pills .nav-link.active {
            background: linear-gradient(45deg, var(--primary-color), #4f46e5); 
            color: white;
            opacity: 1;
            box-shadow: 0 8px 24px rgba(59, 130, 246, .3);
            transform: translateY(-2px);
        }
        
        .tabs-wrapper {
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .tabs-wrapper::-webkit-scrollbar { display: none; }
        .tabs-wrapper .nav { flex-wrap: nowrap; gap: .5rem; }

        .card-product {
            border: none;
            border-radius: 20px;
            overflow: hidden;
            transition: transform .25s ease, box-shadow .25s ease;
            background: var(--glass);
            height: 100%; 
        }
        .card-product:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }
        .card-product img {
            height: 160px; 
            object-fit: cover;
            border-bottom: 1px solid var(--surface-border);
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), #4f46e5);
            border: none;
        }
        .price {
            font-weight: 900;
            letter-spacing: .5px;
            color: var(--secondary-color);
            font-size: 1.1rem;
        }
        .badge-float {
            top: .75rem;
            right: .75rem;
        }
        .qty-input {
            background-color: var(--surface-border);
            text-align: center; 
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spin {
            animation: spin 1s linear infinite;
        }

        .fixed-cart {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 1rem 0;
            background: var(--glass);
            backdrop-filter: blur(10px);
            box-shadow: 0 -10px 30px rgba(0, 0, 0, .1);
            z-index: 10;
            border-top-left-radius: var(--radius);
            border-top-right-radius: var(--radius);
        }
        
        
        #qris-code-box {
            width: 250px;
            height: 250px;
            margin: 0 auto;
            padding: 10px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #qris-code-box > img {
            max-width: 100%;
            height: auto;
        }
        
    </style>
</head>

<body>
    <div class="animated-bg" id="animated-food-icons"></div>

    <nav class="navbar navbar-expand-lg py-3 sticky-top" aria-label="Navigasi utama">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="#">
                <i class="bi bi-cup-hot-fill fs-3 text-primary"></i>
                <span class="brand-gradient">SIMART KANTIN</span>
            </a>
            <div class="ms-auto d-flex align-items-center gap-3">
                
                <button class="btn btn-sm btn-outline-success p-2 rounded-pill shadow-sm d-none d-sm-block" 
                        data-bs-toggle="modal" data-bs-target="#suggestionModal" aria-label="Saran Makanan">
                    <i class="bi bi-chat-dots-fill me-2"></i> Saran Menu
                </button>
                <button class="btn btn-sm btn-outline-success p-2 rounded-circle shadow-sm d-block d-sm-none" 
                        data-bs-toggle="modal" data-bs-target="#suggestionModal" aria-label="Saran Makanan">
                    <i class="bi bi-chat-dots-fill"></i>
                </button>

                <button class="btn btn-sm btn-light p-2 rounded-circle shadow-sm" id="darkModeToggle" aria-label="Toggle dark mode">
                    <i class="bi bi-moon-stars-fill fs-5" id="darkModeIcon"></i>
                </button>

                <a class="position-relative ms-1 text-decoration-none text-dark" href="#" data-bs-toggle="modal" data-bs-target="#detailModal" aria-label="Buka keranjang">
                    <i class="bi bi-basket-fill fs-3 text-primary"></i>
                    <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger shadow-lg d-none">0</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="surface p-3">
            <h5 class="mb-3 fw-bold text-center">Pilih Menu Hari Ini! üëá</h5>
            <div class="tabs-wrapper">
                <ul id="menuTabs" class="nav nav-pills flex-row justify-content-center" role="tablist">
                    <li class="nav-item" role="presentation"><button class="nav-link active" id="tab-rabu" data-bs-toggle="tab" data-bs-target="#pane-rabu" type="button" role="tab" aria-controls="pane-rabu" aria-selected="true">Rabu</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" id="tab-kamis" data-bs-toggle="tab" data-bs-target="#pane-kamis" type="button" role="tab" aria-controls="pane-kamis" aria-selected="false">Kamis</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" id="tab-jumat" data-bs-toggle="tab" data-bs-target="#pane-jumat" type="button" role="tab" aria-controls="pane-jumat" aria-selected="false">Jumat</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" id="tab-sabtu" data-bs-toggle="tab" data-bs-target="#pane-sabtu" type="button" role="tab" aria-controls="pane-sabtu" aria-selected="false">Sabtu</button></li>
                    <li class="nav-item" role="presentation"><button class="nav-link" id="tab-ahad" data-bs-toggle="tab" data-bs-target="#pane-ahad" type="button" role="tab" aria-controls="pane-ahad" aria-selected="false">Ahad</button></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="container mb-5 pb-5">
        <div class="tab-content" id="tabContent">

            <div class="tab-pane fade show active" id="pane-rabu" role="tabpanel" aria-labelledby="tab-rabu">
                <div class="row g-4 mt-1">
                    <div class="col-6 col-sm-6 col-md-4 col-lg-3">
                        <div class="card card-product position-relative">
                            <span class="badge text-bg-success badge-float position-absolute shadow-sm">BEST SELLER</span>
                            <img loading="lazy" src="https://i.pinimg.com/1200x/1c/69/90/1c6990a506575a673f5bb4730934e117.jpg" class="w-100" alt="Nasi Goreng Smoky Delight" />
                            <div class="card-body d-flex flex-column gap-2">
                                <div class="fw-bold text-truncate" title="Nasi Goreng Smoky Delight">Nasi Goreng Smoky Delight</div>
                                <div class="price text-danger">Rp <span class="harga-produk">13.000</span></div>
                                <div class="d-flex align-items-center gap-2 mt-auto">
                                    <button class="btn btn-danger btn-sm subtract-from-cart" data-product-id="rabu_1" data-product-name="Nasi Goreng Smoky Delight" data-product-price="13000" data-product-day="Rabu" aria-label="Kurangi satu"><i class="bi bi-dash-lg"></i></button>
                                    <input disabled id="qty-rabu_1" class="form-control form-control-sm qty-input shadow-none" type="number" value="0" min="0" inputmode="numeric" />
                                    <button class="btn btn-primary btn-sm add-to-cart" data-product-id="rabu_1" data-product-name="Nasi Goreng Smoky Delight" data-product-price="13000" data-product-day="Rabu" aria-label="Tambah satu"><i class="bi bi-plus-lg"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-sm-6 col-md-4 col-lg-3">
                        <div class="card card-product position-relative">
                            <span class="badge text-bg-warning badge-float text-dark position-absolute shadow-sm">PROMO</span>
                            <img loading="lazy" src="https://i.pinimg.com/736x/53/ec/95/53ec951f4576db419b1d531c7dad2c6b.jpg" class="w-100" alt="Nasi Chicken Katsu Curry Jepang" />
                            <div class="card-body d-flex flex-column gap-2">
                                <div class="fw-bold text-truncate" title="Nasi Chicken Katsu Curry Jepang">Nasi Chicken Katsu Curry Jepang</div>
                                <div class="price text-primary">Rp <span class="harga-produk">25.000</span></div>
                                <div class="d-flex align-items-center gap-2 mt-auto">
                                    <button class="btn btn-danger btn-sm subtract-from-cart" data-product-id="rabu_2" data-product-name="Nasi Chicken Katsu Curry Jepang" data-product-price="25000" data-product-day="Rabu" aria-label="Kurangi satu"><i class="bi bi-dash-lg"></i></button>
                                    <input disabled id="qty-rabu_2" class="form-control form-control-sm qty-input shadow-none" type="number" value="0" min="0" inputmode="numeric" />
                                    <button class="btn btn-primary btn-sm add-to-cart" data-product-id="rabu_2" data-product-name="Nasi Chicken Katsu Curry Jepang" data-product-price="25000" data-product-day="Rabu" aria-label="Tambah satu"><i class="bi bi-plus-lg"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-6 col-sm-6 col-md-4 col-lg-3">
                        <div class="card card-product position-relative">
                            <span class="badge text-bg-info badge-float text-dark position-absolute shadow-sm">PROMO</span>
                            <img loading="lazy" src="https://i.pinimg.com/1200x/6b/e8/38/6be838f2583772638efb6c8d9fb76b0e.jpg" class="w-100" alt="Mie Ayam Yamin Manis Gurih" />
                            <div class="card-body d-flex flex-column gap-2">
                                <div class="fw-bold text-truncate" title="Mie Ayam Yamin Manis Gurih">Mie Ayam Yamin Manis Gurih</div>
                                <div class="price text-primary">Rp <span class="harga-produk">20.000</span></div>
                                <div class="d-flex align-items-center gap-2 mt-auto">
                                    <button class="btn btn-danger btn-sm subtract-from-cart" data-product-id="rabu_3" data-product-name="Mie Ayam Yamin Manis Gurih" data-product-price="20000" data-product-day="Rabu" aria-label="Kurangi satu"><i class="bi bi-dash-lg"></i></button>
                                    <input disabled id="qty-rabu_3" class="form-control form-control-sm qty-input shadow-none" type="number" value="0" min="0" inputmode="numeric" />
                                    <button class="btn btn-primary btn-sm add-to-cart" data-product-id="rabu_3" data-product-name="Mie Ayam Yamin Manis Gurih" data-product-price="20000" data-product-day="Rabu" aria-label="Tambah satu"><i class="bi bi-plus-lg"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-6 col-sm-6 col-md-4 col-lg-3">
                        <div class="card card-product position-relative">
                            <span class="badge text-bg-primary badge-float position-absolute shadow-sm">NEW</span>
                            <img loading="lazy" src="https://i.pinimg.com/1200x/dc/af/25/dcaf25d5f4cad2830d8f66ed624895c1.jpg" class="w-100" alt="Spaghetti Bolognese 'Gila Keju'" />
                            <div class="card-body d-flex flex-column gap-2">
                                <div class="fw-bold text-truncate" title="Spaghetti Bolognese 'Gila Keju'">Spaghetti Bolognese 'Gila Keju'</div>
                                <div class="price text-primary">Rp <span class="harga-produk">15.000</span></div>
                                <div class="d-flex align-items-center gap-2 mt-auto">
                                    <button class="btn btn-danger btn-sm subtract-from-cart" data-product-id="rabu_4" data-product-name="Spaghetti Bolognese 'Gila Keju'" data-product-price="15000" data-product-day="Rabu" aria-label="Kurangi satu"><i class="bi bi-dash-lg"></i></button>
                                    <input disabled id="qty-rabu_4" class="form-control form-control-sm qty-input shadow-none" type="number" value="0" min="0" inputmode="numeric" />
                                    <button class="btn btn-primary btn-sm add-to-cart" data-product-id="rabu_4" data-product-name="Spaghetti Bolognese 'Gila Keju'" data-product-price="15000" data-product-day="Rabu" aria-label="Tambah satu"><i class="bi bi-plus-lg"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="pane-kamis" role="tabpanel" aria-labelledby="tab-kamis"><div class="row g-4 mt-1"><div class="col-12 text-center text-muted p-5"><i class="bi bi-clock-history fs-1 mb-3"></i><h4>Menu Kamis Belum Tersedia</h4><p>Silakan kembali besok!</p></div></div></div>
            <div class="tab-pane fade" id="pane-jumat" role="tabpanel" aria-labelledby="tab-jumat"><div class="row g-4 mt-1"><div class="col-12 text-center text-muted p-5"><i class="bi bi-x-octagon-fill fs-1 mb-3 text-danger"></i><h4>Menu Jumat Masih Rahasia!</h4><p>Tunggu kejutan dari SIMART Kantin!</p></div></div></div>
            <div class="tab-pane fade" id="pane-sabtu" role="tabpanel" aria-labelledby="tab-sabtu"><div class="row g-4 mt-1"><div class="col-12 text-center text-muted p-5"><i class="bi bi-emoji-sunglasses-fill fs-1 mb-3 text-warning"></i><h4>Weekend Menu (Sabtu)</h4><p>Akan segera diumumkan!</p></div></div></div>
            <div class="tab-pane fade" id="pane-ahad" role="tabpanel" aria-labelledby="tab-ahad"><div class="row g-4 mt-1"><div class="col-12 text-center text-muted p-5"><i class="bi bi-house-door-fill fs-1 mb-3 text-success"></i><h4>Hari Minggu = Libur!</h4><p>Kantin tutup. Selamat istirahat! üò¥</p></div></div></div>
        </div>
    </div>

    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content surface">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold" id="detailModalLabel"><i class="bi bi-basket-fill me-2 text-primary"></i> Detail Keranjang</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <div id="cart-items-list">
                        </div>
                    <hr class="my-3" />
                    <div class="d-flex justify-content-between align-items-center fw-bold fs-5 mt-3">
                        <span>Total Bayar:</span>
                        <span class="price text-danger" id="cart-total-price">Rp 0</span>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Lanjut Belanja</button>
                    <button type="button" class="btn btn-primary btn-lg px-4" id="checkoutButton" disabled>
                        <i class="bi bi-bag-check-fill me-2"></i> Checkout Sekarang
                    </button>
                </div>
                <div id="whatsapp-info" class="p-3 bg-light rounded-bottom text-center small text-dark">
                    <i class="bi bi-info-circle-fill me-1 text-primary"></i> Anda akan diarahkan ke halaman pembayaran QRIS.
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="qrisPaymentModal" tabindex="-1" aria-labelledby="qrisPaymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
            <div class="modal-content surface text-center p-3">
                <div class="modal-header border-0 pb-0 justify-content-center">
                    <h5 class="modal-title fw-bold" id="qrisPaymentModalLabel">
                        <i class="bi bi-qr-code me-2" style="color: var(--secondary-color);"></i> SIMART ‚Ä¢ Bayar QRIS
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-3">
                        <small class="text-muted">Scan menggunakan aplikasi pembayaran apa pun (Gopay, Dana, dll.)</small>
                        <h4 class="fw-bold mt-2">QRIS SIMART</h4>
                    </div>

                    <div id="qris-code-box" class="mb-4">
                        <div id="qrcode"></div>
                    </div>

                    <p class="small text-muted mb-2">Kode ini bersifat **statis (mockup)** dan hanya untuk tampilan. Untuk transaksi asli, harus terhubung ke API Payment Gateway.</p>

                    <h4 class="fw-bold">Total Bayar: Rp <span class="text-danger" id="qris-total-amount">0</span></h4>
                    <div class="text-center small text-muted mb-4">
                        <i class="bi bi-clock-fill me-1"></i> Waktu Transaksi: <span id="qris-timer">--:--</span>
                    </div>

                    <button class="btn btn-success w-100 fw-bold py-2 mb-2" id="qrisConfirmWaButton">
                        <i class="bi bi-whatsapp me-2"></i> Konfirmasi Pembayaran via WhatsApp
                    </button>
                    <button class="btn btn-warning w-100 py-2 text-dark" id="qrisCloseButton" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle-fill me-2"></i> Batalkan & Lanjut Belanja
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="suggestionModal" tabindex="-1" aria-labelledby="suggestionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content surface">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold" id="suggestionModalLabel"><i class="bi bi-lightbulb-fill me-2 text-success"></i> Saran Menu Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <p class="text-muted small">Yuk, bantu kami menyajikan menu terbaik. Masukkan saran makanan yang kamu mau!</p>
                    
                    <form id="suggestionForm" action="https://formspree.io/f/mdkwlnwv" method="POST">
                        <div class="mb-3">
                            <label for="inputName" class="form-label small fw-semibold">Nama (Opsional)</label>
                            <input type="text" class="form-control" id="inputName" name="Nama" placeholder="Cth: Ihsan Nur Fadhil">
                        </div>

                        <div class="mb-3">
                            <label for="inputSuggestion" class="form-label small fw-semibold">Saran Makanan/Minuman üåü</label>
                            <textarea class="form-control" id="inputSuggestion" name="Saran Makanan" rows="3" placeholder="Cth: coba kalo misalkan ayam kecap di hari sabtu kyknya enak bngt" required></textarea>
                        </div>

                        <button type="submit" class="btn btn-success w-100 mt-2" id="suggestionSubmitButton">
                            <i class="bi bi-send-fill me-2"></i> Kirim Saran
                        </button>
                        <p id="suggestionStatus" class="mt-3 text-center small fw-semibold"></p>
                    </form>

                </div>
            </div>
        </div>
    </div>


    <div class="fixed-cart d-none" id="fixed-cart-bar">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="text-start">
                    <span class="d-block fw-bold fs-6" id="fixed-cart-count">0 Item</span>
                    <span class="d-block price fs-5" id="fixed-cart-total">Rp 0</span>
                </div>
                <button class="btn btn-primary btn-lg shadow-lg" data-bs-toggle="modal" data-bs-target="#detailModal">
                    Lihat Keranjang
                    <i class="bi bi-arrow-right-circle-fill ms-2"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let cart = JSON.parse(localStorage.getItem('simartCart')) || {};
        const WA_NUMBER = '6281996481958'; 
        
        
        const DEFAULT_TITLE = "üçö SIMART Kantin";
        const AWAY_TITLE = "üõí Lanjut Belanja!";
        

        const SAVED_THEME = localStorage.getItem('simartTheme') || 'dark'; 
        
        
        const cartBadge = document.getElementById('cart-badge');
        const cartTotalElement = document.getElementById('cart-total-price');
        const cartListElement = document.getElementById('cart-items-list');
        const checkoutButton = document.getElementById('checkoutButton');
        const fixedCartBar = document.getElementById('fixed-cart-bar');
        const fixedCartCount = document.getElementById('fixed-cart-count');
        const fixedCartTotal = document.getElementById('fixed-cart-total');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.getElementById('darkModeIcon');
        const suggestionForm = document.getElementById('suggestionForm');
        const suggestionStatus = document.getElementById('suggestionStatus');
        const suggestionSubmitButton = document.getElementById('suggestionSubmitButton');
        const animatedBg = document.getElementById('animated-food-icons');
        const qrisTotalAmount = document.getElementById('qris-total-amount');
        const qrisTimerDisplay = document.getElementById('qris-timer');
        const qrisConfirmWaButton = document.getElementById('qrisConfirmWaButton');
        const qrisModalEl = document.getElementById('qrisPaymentModal');

        let qrisTimerInterval; 
        let qrisInstance;
        
        
        const foodEmojis = ['üçî', 'üçü', 'üçï', 'ü•§', '‚òï', 'üç©', 'üç£', 'üçé', 'üçú', 'üçö', 'üç¶', 'üçπ', 'üåÆ', 'üå∂Ô∏è', 'üî•', 'üíß'];


        
        function formatRupiah(number) {
            if (typeof number !== 'number' || isNaN(number)) return 'Rp 0'; 
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }
        

        function generateWhatsAppMessage(totalPrice) {
            let message = "‚úÖ *Konfirmasi Pembayaran QRIS SIMART*\n\n";
            message += `Saya sudah melakukan pembayaran sebesar *${formatRupiah(totalPrice)}*.\n\n`;
            message += "Mohon dicek dan diproses pesanan saya:\n\n";

            let itemNumber = 1;
            const sortedCart = Object.values(cart)
                .filter(item => item.name && !isNaN(parseInt(item.price)) && item.qty > 0) 
                .sort((a, b) => a.day.localeCompare(b.day));

            for (const item of sortedCart) {
                const price = parseInt(item.price);
                message += `${itemNumber}. ${item.name} (${item.day}) x ${item.qty} = ${formatRupiah(item.qty * price)}\n`;
                itemNumber++;
            }

            message += "\n*Segera proses ya! Terima kasih! üôè*";

            return encodeURIComponent(message);
        }
        
        
        function handleCheckout() {
            const { totalPrice, totalItems } = calculateCartTotals();
            if (totalPrice === 0) return;

           
            checkoutButton.classList.add('disabled');
            checkoutButton.innerHTML = '<span class="spin spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Menyiapkan QRIS...';

           
            const detailModal = bootstrap.Modal.getInstance(document.getElementById('detailModal'));
            if(detailModal) detailModal.hide();
            
           
            
            
            const qrisData = `Pembayaran SIMART Kantin - Total: ${formatRupiah(totalPrice)} - Jumlah Item: ${totalItems} - Tanggal: ${new Date().toISOString()}`;
            const expiryTimeMinutes = 5; 

            setTimeout(() => {
               
                qrisTotalAmount.textContent = formatRupiah(totalPrice).replace('Rp', '').trim();
                
                
                document.getElementById('qrcode').innerHTML = '';
                if (qrisInstance) {
                    qrisInstance.clear(); 
                }
                
               
                qrisInstance = new QRCode(document.getElementById("qrcode"), {
                    text: qrisData,
                    width: 230,
                    height: 230,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                });

                
                qrisConfirmWaButton.onclick = () => {
                    const waLink = `https://wa.me/${WA_NUMBER}?text=${generateWhatsAppMessage(totalPrice)}`;
                    window.open(waLink, '_blank');
                };

                
                checkoutButton.classList.remove('disabled');
                checkoutButton.innerHTML = '<i class="bi bi-bag-check-fill me-2"></i> Checkout Sekarang';
                
                const qrisModal = new bootstrap.Modal(qrisModalEl);
                qrisModal.show();
                
               
                startQrisTimer(expiryTimeMinutes * 60);

            }, 1000); 
        }


        
        function setAwayTitle() {
            document.title = AWAY_TITLE;
        }

        
        function setDefaultTitle() {
            document.title = DEFAULT_TITLE;
        }

        
        window.addEventListener('blur', setAwayTitle);
        window.addEventListener('focus', setDefaultTitle);

       


        
        function updateCart(productId, productName, productPrice, productDay, action) {
            if (!cart[productId]) {
                cart[productId] = { id: productId, name: productName, price: parseInt(productPrice), qty: 0, day: productDay };
            }

            if (action === 'add') {
                cart[productId].qty += 1;
            } else if (action === 'subtract' && cart[productId].qty > 0) {
                cart[productId].qty -= 1;
            }

            if (cart[productId].qty === 0) {
                delete cart[productId];
            }

            
            localStorage.setItem('simartCart', JSON.stringify(cart));
            
           
            updateUI(productId);
        }

        
        function calculateCartTotals() {
            let totalItems = 0;
            let totalPrice = 0;
            for (const id in cart) {
                totalItems += cart[id].qty;
                totalPrice += cart[id].qty * cart[id].price;
            }
            return { totalItems, totalPrice };
        }

        
        function updateUI(productId = null) {
            const { totalItems, totalPrice } = calculateCartTotals();

            
            cartBadge.textContent = totalItems;
            fixedCartCount.textContent = `${totalItems} Item`;
            fixedCartTotal.textContent = formatRupiah(totalPrice);
            
            if (totalItems > 0) {
                cartBadge.classList.remove('d-none');
                fixedCartBar.classList.remove('d-none');
                checkoutButton.disabled = false;
            } else {
                cartBadge.classList.add('d-none');
                fixedCartBar.classList.add('d-none');
                checkoutButton.disabled = true;
            }

            
            renderCartList(totalPrice);
            
            
            if (productId) {
                const qtyInput = document.getElementById(`qty-${productId}`);
                if (qtyInput) {
                    qtyInput.value = cart[productId] ? cart[productId].qty : 0;
                }
            }
        }

        
        function renderCartList(totalPrice) {
            cartListElement.innerHTML = '';
            cartTotalElement.textContent = formatRupiah(totalPrice);
            const cartItems = Object.values(cart).filter(item => item.qty > 0);

            if (cartItems.length === 0) {
                cartListElement.innerHTML = `
                    <div class="text-center p-5 text-muted">
                        <i class="bi bi-basket-fill fs-1 mb-3 text-warning"></i>
                        <h5>Keranjang masih kosong, Bro!</h5>
                        <p>Ayo pilih menu lezat hari ini!</p>
                    </div>
                `;
                return;
            }

            cartItems.forEach(item => {
                const itemTotal = item.qty * item.price;
                const itemHtml = `
                    <div class="d-flex align-items-center justify-content-between p-3 surface my-2">
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fw-bold">${item.name} <small class="text-muted">(${item.day})</small></h6>
                            <span class="small text-primary">${formatRupiah(item.price)} x ${item.qty}</span>
                        </div>
                        <div class="text-end ms-3">
                            <span class="price d-block">${formatRupiah(itemTotal)}</span>
                            <button class="btn btn-danger btn-sm mt-1 remove-from-cart-full" data-product-id="${item.id}" aria-label="Hapus dari keranjang"><i class="bi bi-trash-fill"></i> Hapus</button>
                        </div>
                    </div>
                `;
                cartListElement.insertAdjacentHTML('beforeend', itemHtml);
            });

            
            document.querySelectorAll('.remove-from-cart-full').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = e.currentTarget.dataset.productId;
                   
                    cart[productId].qty = 0;
                    delete cart[productId]; 
                    localStorage.setItem('simartCart', JSON.stringify(cart));
                    updateUI(); 
                });
            });
        }

       
        function toggleDarkMode(theme) {
            const newTheme = theme || (document.documentElement.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark');
            document.documentElement.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('simartTheme', newTheme);
            
            // Update icon
            if (newTheme === 'dark') {
                darkModeIcon.classList.remove('bi-sun-fill');
                darkModeIcon.classList.add('bi-moon-stars-fill');
            } else {
                darkModeIcon.classList.remove('bi-moon-stars-fill');
                darkModeIcon.classList.add('bi-sun-fill');
            }
        }

        
        function startQrisTimer(duration) {
            let timer = duration, minutes, seconds;
            
           
            if (qrisTimerInterval) clearInterval(qrisTimerInterval);

            qrisTimerInterval = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                qrisTimerDisplay.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    timer = 0; 
                    clearInterval(qrisTimerInterval);
                    qrisTimerDisplay.textContent = "00:00 (Kadaluarsa!)";
                    qrisConfirmWaButton.disabled = true;
                    qrisConfirmWaButton.textContent = "Pembayaran Kadaluarsa";
                }
            }, 1000);
        }

        
        function initAnimatedBackground() {
            const count = 30;
            for (let i = 0; i < count; i++) {
                const icon = document.createElement('span');
                icon.classList.add('animated-icon');
                icon.innerHTML = foodEmojis[Math.floor(Math.random() * foodEmojis.length)];
                
               
                icon.style.left = `${Math.random() * 100}vw`;
                icon.style.fontSize = `${Math.random() * 15 + 15}px`;
                icon.style.animationDuration = `${Math.random() * 20 + 10}s`;
                icon.style.animationDelay = `-${Math.random() * 20}s`; 
                
                animatedBg.appendChild(icon);
            }
        }
        
        

        document.addEventListener('DOMContentLoaded', () => {
           
            toggleDarkMode(SAVED_THEME);
            darkModeToggle.addEventListener('click', () => toggleDarkMode());
            
            
            initAnimatedBackground();

            
            document.querySelectorAll('.qty-input').forEach(input => {
                const productId = input.id.replace('qty-', '');
                input.value = cart[productId] ? cart[productId].qty : 0;
            });
            updateUI(); 

            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', (e) => {
                    const btn = e.currentTarget;
                    updateCart(
                        btn.dataset.productId,
                        btn.dataset.productName,
                        btn.dataset.productPrice,
                        btn.dataset.productDay,
                        'add'
                    );
                });
            });

            document.querySelectorAll('.subtract-from-cart').forEach(button => {
                button.addEventListener('click', (e) => {
                    const btn = e.currentTarget;
                    updateCart(
                        btn.dataset.productId,
                        btn.dataset.productName,
                        btn.dataset.productPrice,
                        btn.dataset.productDay,
                        'subtract'
                    );
                });
            });
            
            
            checkoutButton.addEventListener('click', handleCheckout);
            
            
            suggestionForm.addEventListener("submit", async function (e) {
                e.preventDefault();
                suggestionSubmitButton.disabled = true;
                suggestionSubmitButton.innerHTML = '<span class="spin spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> Mengirim...';
                suggestionStatus.textContent = '';
                
                const response = await fetch(e.target.action, {
                    method: 'POST',
                    body: new FormData(e.target),
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    suggestionStatus.textContent = '‚úÖ Saranmu sudah terkirim! Terima kasih!';
                    suggestionStatus.classList.remove('text-danger');
                    suggestionStatus.classList.add('text-success');
                    suggestionForm.reset();
                    setTimeout(() => bootstrap.Modal.getInstance(document.getElementById('suggestionModal')).hide(), 1500);
                } else {
                    suggestionStatus.textContent = '‚ùå Gagal mengirim saran. Coba lagi.';
                    suggestionStatus.classList.remove('text-success');
                    suggestionStatus.classList.add('text-danger');
                }
                
                suggestionSubmitButton.disabled = false;
                suggestionSubmitButton.innerHTML = '<i class="bi bi-send-fill me-2"></i> Kirim Saran';
            });
            
           
            qrisModalEl.addEventListener('hidden.bs.modal', function () {
                clearInterval(qrisTimerInterval); 
                qrisTimerDisplay.textContent = "--:--"; 
                qrisConfirmWaButton.disabled = false;
                qrisConfirmWaButton.textContent = '<i class="bi bi-whatsapp me-2"></i> Konfirmasi Pembayaran via WhatsApp';
            });
        });
    </script>
</body>
</html>